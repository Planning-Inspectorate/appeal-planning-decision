{% extends layoutTemplate %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block pageTitle %}
  {{ title }}
{% endblock %}

{% block content %}

  {% block beforeTaskList %}
  {% endblock %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      
      <style>
        .app-task-list {
          padding-left: 0;
        }
        .app-task-list>li {
          position: relative;
          list-style-type: none;

        }
        .app-task-list__section .govuk-tag {
          position: absolute;
          top: 3px;
          right: 0;
        }
        .app-task-list .govuk-summary-list {
          border-top: 1px solid #b1b4b6;
        }
      </style>
      
      <ol class="app-task-list">
      {% for section in summaryListData.sections %}
        <li class ="govuk-!-margin-bottom-9">
        <div class="app-task-list__section">
            <h2 class="govuk-heading-m">
              <span class="app-task-list__section-number">{{loop.index}}. </span> {{section.heading}}
              {%- if section.status %}
                {%- if section.status == 'Completed' %}
                  {{ govukTag({
                    text: section.status,
                    classes: 'moj-task-list__task-completed'
                  }) }}
                {%- elif section.status == 'In progress' %}
                  {{ govukTag({
                    text: section.status,
                    classes: 'govuk-tag--blue moj-task-list__task-completed'
                  }) }}
                {% else %}
                  {{ govukTag({
                    text: section.status,
                    classes: 'govuk-tag--grey moj-task-list__task-completed'
                  }) }}
                {% endif -%}
              {% endif -%}
            </h2>
        </div>
        
        {% if section.list.rows.length %}
          {{ govukSummaryList(section.list) }}
        {% endif %}

        </li>
      {% endfor %}
        <li>
          <div class="app-task-list__section">
            <h2 class = 'govuk-heading-m'> 
              <span class="app-task-list__section-number">{{summaryListData.sections.length + 1}}. </span> 
              Submit
            {% if journeyComplete %}
                <strong class="govuk-tag govuk-tag--blue">
                  Ready to submit
                </strong>
                </h2>
                <p>By submitting this questionnaire you are confirming that, to the best of your knowledge, the details you are providing are correct.</p>
              <form action method="post">
<input type="hidden" name="_csrf" value="{{_csrf}}">
                {{ govukButton({
                  text: "Submit questionnaire",
                  type: "submit",
                  attributes: { "data-cy":"submit-questionnaire"}
                }) }}
              </form>
            {% else %}
              <strong class="govuk-tag govuk-tag--grey">
                Cannot start yet
              </strong>
              </h2>
              <p>You cannot submit the questionnaire until all of the other sections are complete.</p>
            {% endif %}
          </div>
        </li>
      </ol>
    </div>
  </div>

  {% block afterTaskList %}
  {% endblock %}

{% endblock %}