const { PrismaClient } = require('@prisma/client');
const config = require('../configuration/config');

/** @type {import('@prisma/client').Prisma.PrismaClientOptions} */
let prismaConfig = {
	datasourceUrl: config.db.sql.connectionString
};

// log sql queries generated by prisma
if (config.logger.level === 'debug') {
	prismaConfig.log = ['query'];
}

/** @type {import('@prisma/client').PrismaClient} */
let prisma;

/**
 * @returns {import('@prisma/client').PrismaClient}
 */
const createPrismaClient = () => {
	if (prisma) {
		return prisma;
	}

	prisma = new PrismaClient(prismaConfig);
	return prisma;
};

module.exports = { createPrismaClient };
