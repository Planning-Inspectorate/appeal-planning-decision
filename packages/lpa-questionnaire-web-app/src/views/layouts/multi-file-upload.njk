{% extends "layouts/main.njk" %}

{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "components/appeal-details/macro.njk" import appealDetails %}
{%- from "govuk/components/file-upload/macro.njk" import govukFileUpload -%}
{%- from "moj/components/multi-file-upload/macro.njk" import mojMultiFileUpload -%}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% block beforeContent %}
  {{ govukBackLink({
    text: 'Back',
    href: backLink,
    attributes: {
      'data-cy': 'back'
    }
  }) }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      {% if errorSummary and errorSummary.length %}
        {{ govukErrorSummary({
          titleText: "There is a problem",
          errorList: errorSummary
        }) }}
      {% endif %}

      <form action="" method="POST" novalidate encType="multipart/form-data">
        <span class="govuk-caption-l"><span class="govuk-visually-hidden">Section. </span>{% block sectionName %}{% endblock %}</span>
        <h1 class="govuk-heading-l">{% block pageHeading %}{% endblock %}</h1>
        {{ govukInsetText({
          text: "File size should be no more than " + fileSizeLimits.maxFileSize | formatBytes
        }) }}

        {% set uploadHtml %}
          {{ govukFileUpload({
            id: 'documents',
            name: 'documents',
            classes: 'moj-multi-file-upload__input',
            label: {
              text: 'Upload a file',
              classes: 'govuk-label--m'
            },
            attributes: { multiple: '' },
            errorMessage: errorMessage and {
              text: errorMessage
            }
          }) }}

          {{govukButton({
            text: 'Upload file',
            classes: 'govuk-button--secondary moj-multi-file-upload__button',
            name: 'upload',
            value: 'upload'
          })}}
        {% endset %}

        {{ mojMultiFileUpload({
          uploadedFiles: {
            heading: { text: 'Files added' },
            items: uploadedFiles
          },
          uploadHtml: uploadHtml
        }) }}

        {% set acceptedFormats %}
          <ul class="govuk-list govuk-list--bullets">
            <li>PDF – <strong>.pdf</strong></li>
            <li>Microsoft Word – <strong>.doc</strong> or <strong>.docx</strong></li>
            <li>TIF – <strong>.tif</strong> or <strong>.tiff</strong></li>
            <li>JPEG – <strong>.jpg</strong> or <strong>.jpeg</strong></li>
            <li>PNG – <strong>.png</strong></li>
          </ul>
        {% endset %}

        {{ govukDetails({
          summaryText: 'Accepted file formats',
          html: acceptedFormats
        }) }}

        {{ govukButton({
          text: 'Save and continue',
          name: 'submit',
          value: 'save'
        }) }}
      </form>
    </div>

    {{
      appealDetails({
        appeal: appeal
      })
    }}
  </div>
{% endblock %}

{% block pageScripts %}
<script src="/assets/moj/all.js"></script>
<script src="/assets/jquery/jquery.min.js"></script>
<script>
window.MOJFrontend.initAll();

if (typeof MOJFrontend.MultiFileUpload !== 'undefined') {
  new MOJFrontend.MultiFileUpload({
    container: $('.moj-multi-file-upload'),
    uploadUrl: '/upload',
    deleteUrl: '/delete',
  });
}
</script>
{% endblock %}
