---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: app
  namespace: app-dev
  annotations:
    fluxcd.io/automated: "true"
    # Add hyphen to include pre-releases
    filter.fluxcd.io/appealsServiceApi: semver:^2.0.0-0
    filter.fluxcd.io/documentServiceApi: semver:^1.0.0-0
    filter.fluxcd.io/formsWebApp: semver:^1.0.0-0
spec:
  releaseName: app
  chart:
    git: git@github.com:foundry4/appeal-planning-decision.git
    ref: master
    path: charts/app
  rollback:
    enable: true
  values:
    appealsServiceApi:
      replicaCount: 2
      image:
        repository: pinscommonukscontainers3887default.azurecr.io/appeals-service-api
        tag: 2.4.0-rc.3

    documentServiceApi:
      replicaCount: 2
      image:
        repository: pinscommonukscontainers3887default.azurecr.io/document-service-api
        tag: 1.1.0

    formsWebApp:
      replicaCount: 2
      image:
        repository: pinscommonukscontainers3887default.azurecr.io/forms-web-app
        tag: 1.21.0-rc.12

    keyVault:
      name: pins-uks-vault-7579-dev

    ingress:
      host: appeals-dev.planninginspectorate.gov.uk
      redirects:
        - path: /path
          target: /target
